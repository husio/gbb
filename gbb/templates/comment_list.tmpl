{{template "header.tmpl"}}

<style>
.comment { padding: 10px; margin: 20px 0; }
.comment-content { padding-left: 20px; }
</style>

<body>
  <span id="top"></span>

  <p>
    <a href="/t/">Back to listing</a>
  </p>

  <hr>

  <h1>{{.Topic.Subject}}</h1>
  {{range .Comments}}
    <div class="comment" id="comment-{{.CommentID}}">
      <div class="comment-header">
        <a href="#comment-{{.CommentID}}" title="direct link to the comment">#</a>
        <a href="/u/{{.Author.UserID}}/">{{.Author.Name}}</a>
        at <span title="{{.Created.Format "2006-01-02 at 15:04 -0700"}}">{{.Created.Format "Monday, _2 Jan 2006"}}</span>
      </div>
      <div class="comment-content">
        <p>{{.Content | markdown}}</p>
      </div>
    </div>
  {{else}}
    No comments
  {{end}}

  <hr>

  <p>
    Pagination:
    {{range .Pagination.Pages}}
      {{if .Active}}
        {{.Number}}
      {{else}}
        <a href="./?page={{.Number}}">{{.Number}}</a>
      {{end}}
      {{if not .IsLast}}, {{end}}
    {{end}}
  </p>

  <p>
    {{if .Pagination.HasPrevPage}}
      <a href="./?page={{.Pagination.PrevPage}}">Previous page</a>
    {{else}}
      Previous page
    {{end}}
    | Page {{.Pagination.CurrentPage}} of {{.Pagination.PageCount}} |
    {{if .Pagination.HasNextPage}}
      <a href="./?page={{.Pagination.NextPage}}">Next page</a>
    {{else}}
        NextPage
    {{end}}
  </p>

  <p>
    <a href="#top">Top of the page</a>
    |
    <a href="/t/">Back to listing</a>
  </p>

  {{if .CurrentUser}}
    {{if .Pagination.HasNextPage}}
      <div class="box-info">
        Commenting is possible only from the <a href="/t/{{.Topic.TopicID}}/last-comment/{{.Topic.SlugInfo}}">last page of the topic</a>.
      </div>
    {{else}}
      <form method="POST" action="/t/{{.Topic.TopicID}}/comment/" enctype="multipart/form-data" autocomplete="off">
        <textarea name="content" id="comment-content" placeholder="Write your comment. Use markdown." required {{if not .CurrentUser}}disabled{{end}}></textarea>
        <button type="submit" {{if not .CurrentUser}}disabled{{end}}>Comment</button>
        {{.CsrfField}}

        writing as <em>{{.CurrentUser.Name}}</em>
      </form>
    {{end}}
  {{else}}
    <div class="box-info">
      You must be authenticated to comment.
      <a href="/login/?next=/t/{{.Topic.TopicID}}/last-comment/%23bottom">Login</a> with existing account or
      <a href="/register/?next=/t/{{.Topic.TopicID}}/last-comment/%23bottom">create one</a>.
    </div>
  {{end}}

  <span id="bottom"></span>
</body>
